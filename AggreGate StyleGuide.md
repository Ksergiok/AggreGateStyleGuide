# Стайлгайд для AggreGate
В настоящем документе приведены рекомендации по разработке на платформе AggreGate.
Следование данным рекомендациям позволит упростить  разработку приложений и их последующее сопровождение.

# Именование
## Используйте camelCase для именования сущностей
При добавлении сущности (устройство, модель, переменная, фукнция и других), рекомендуется использовать стиль именования **lowerCamelCase**.
Все составные слова пишутся слитно, без пробелов, каждое слово во фразе начинается с заглавной буквы, кроме первого.
Для именования набора правил, рекомендуется добавлять постфикс **RS, либо R, либо RuleSet** в конце имени.
### Примеры:
- Имя контекста: monitoringMainPage, mqttDevice;
- Имя функции: getUserInformation, xmlHttpRequest;
- Имя набора правил: getUserInformationRS, xmlHttpRequestRS;
- Имя переменной: inputData, unitsList;

## Давайте сущностям значимые имена
Имя должно быть понятным и отображать суть сущность (устройство, модель, переменная и т.д.). При разработке приложения постоянно приходится обращаться к сущностям, например получить данные из переменной, в таком случае, правильное имя поможет быстрее найти ее в списке других переменных.
Понятные имена повышают читаемость кода и конфигурации.
Применение коротких имен (a, x, var и т.д.) считается плохой практикой,  как и в большинстве языков прогарммирования.

## Название функции и набора правил должно начинаться с глагола
Любая функция или набор правил всегда выполняют определенное действие. Именно поэтому, их имя должно отвечать на вопрос “Что делает эта функция/набор правил?”. Благодаря этому, в любом месте приложения будет понятно что делает вызываемая функция/набор правил.

**Примеры**
- getDeviceTelemetry
- createSensor
- getUserInformation
- sendAlertsListByEmail

# Комментарии
## Заполняйте поле описание и комментарии
Заполненные описания сущснотей (устройство, модель, переменная и т.д.) помогают при разработке и особенно при сопровождении приложения. Благодаря понятным описаниям легко определить назначение различных сущностей
По комментариям в наборах правил можно быстро понять назначения отдельного шага, и общую структуру всей выполняемой функции.
Комментарий должен отражать суть действия, а не описывать каждую операцию.
Внутри выражений комментарии надо сводить к минимуму. Еслы вы понимаете, что код трудно понять без комментариев, то скорее всего его надо разбить на отдлеьные функции, либо наборы правил.

## Не оставляйте закомментированные фрагменты кода в выражении, и лишние сущности
Иногда для отладки выражения приходится заменять переменные окружения на прямые ссылки. Так как процесс отладки может занимать несколько итераций в коде выражения часто присутствуют сразу два варианта исполнения, один из которых закомментирован. Подобные куски кода надо обязательно убирать по окончанию отладки. Ведь это потенциальная уязвимость приложения, особенно, если в них содержатся важные данные, например имена пользователей, пароли, IP адреса.
Также нельзя оставлять контексты, переменные, функции и другие сущности, которые требовались на этапе разработке, но не применяются при работе приложения. Наличие таких сущностей значительно усложняет сопровождение приложения.

# Разработка
## Создавайте справочники вместо прямых ссылок и констант
Использовать прямые ссылки и константы может быть удобно при написании кода, однако в долгосрочной перспективе это может усложнить доработку приложения. Использование справочников закладывает фундамент для дальнейшей масштабируемости проекта. К тому же, использование констант может привести к тому, что один и тот же параметр в системе будет иметь разные имена.
В большинстве случаев, в качестве имени параметра в справочнике лучше использовать цифровое значение, а в описании уже писать подробную информацию.

## Располагайте параметры функции в выражении в столбик
В языке выражений для большинства функций надо задавать различные параметры. В описании каждой функции указаны ее параметры, записанные в одну строку через запятую. Если параметров меньше трех и они достаточно короткие, то допустимо в коде выражения писать их в одну строку. Однако, в большинстве случаев необходимо указать параметры в столбик. Это значительно облегчает работу с функцией и делает ее более читаемой. 
Разделители строки (знаки “,” или “+”) необходимо ставить в начале строки. Это поможет понять где начинается новый параметр и облегчит работу с кодом.

## Разбивайте длинные “строчные” выражения на несколько строк
В языке выражений параметры во многих функциях задаются в формате строки. Их длина может быть довольно большой, что в свою очередь может привести к ухудшению восприятия выражения. В таких случаях рекомендуется разбивать одну строку на несколько. Чтобы разбить строку, необходимо в нужном месте поставить закрывающие кавычки, затем написать знак “+”(конкатенация) и открыть кавычки перед оставшейся частью текста. Этим способом удобно разделять параметры вложенных функций.

**Важно**
Все разделители необходимо ставить в начале строки. К ним относятся:
- Плюс: “+”. Разделяет части одного “строчного” выражения;
- Пробел: “ “. Разделяет слова в строке;
- Запятая: “,”. Разделяет параметры в функциях;

## Используйте табуляцию для вложенных функций в выражениях
При написании кода выражения необходимо использовать табуляцию для параметров, перечисленных в столбик, и вложенных функций. Это сильно облегчает восприятие кода. Хорошо видны начало и конец каждого уровня вложенности, число параметров и функций.

## Избегайте большой вложенности в выражениях
Выражения могут содержать множество функций, как вложенных, так и выполняемых последовательно с различными условиями. Понять такие выражения может быть тяжело, а работать с ними не удобно. В таких случаях лучше всего использовать наборы правил в моделях. Благодаря этому каждый отдельный шаг выражения будет явно виден. Это облегчит не только работу по созданию функционала проекта, но дальнейшую его поддержку.
Не рекомендуется создавать выражение, более чем с пятью вложенными уровнями.

**Замечание**
Иногда вместо использование языка выражений лучше написать скрипт на Java. Например, для организации цикла или обработки большого массива данных. Самое главное помнить, что не все разработчики на платформе знают язык Java.

## Используйте валидаторы
Валидаторы - очень важная часть любого проекта. Грамотное их использование позволит избежать непредсказуемого поведения различных элементов системы. Особенно важно их использовать в местах получения пользовательского ввода. При этом ограничения должны быть обоснованы, например для ввода IP адреса будет 4 блока с цифровыми значениями от 0 до 255. Также очень важно информировать пользователя о тех ограничениях, что установлены в системе, чтобы ему не пришлось догадываться, почему не работает функция или параметр не принят.

# Плохие практики

## Функция sleep
Как правило использование функции sleep является плохой практикой. Вместо этого старайтесь реагировать на события.

## Периодические привязки
Периодические привязки тяжелее отлаживать и контролировать, они могут приводить к утечкам памяти и другим нежелательным последствиям. По возможности их необходимо заменять на работу по событиям, либо вызов функции из планировщика задач.
